<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compilador, entre aspas</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <script>
        const parsingTable = {
            'E': { '(': ['T', 'X'], 'id': ['T', 'X'] },
            'F': { '(': ['(', 'E', ')'], 'id': ['id'] },
            'T': { '(': ['F', 'Y'], 'id': ['F', 'Y'] },
            'X': { '+': ['+', 'T', 'X'], '$': ['ε'], ')': ['ε'] },
            'Y': { '+': ['ε'], '*': ['*', 'F', 'Y'], '$': ['ε'], ')': ['ε'] }
        };

        function lexicalAnalyzer(input) {
            const tokens = [];
            let i = 0;

            while (i < input.length) {
                const char = input[i];
                if (/[a-zA-Z]/.test(char)) {
                    let id = char;
                    i++;
                    while (i < input.length && /[a-zA-Z0-9]/.test(input[i])) {
                        id += input[i];
                        i++;
                    }
                    tokens.push('id'); // Simplifying all identifiers to 'id'
                } else {
                    switch (char) {
                        case '+': case '*': case '(': case ')': tokens.push(char); break;
                        case ' ': case '\t': case '\n': break; // Skip whitespace
                        default: return `Lexical error at position ${i}: unexpected character '${char}'`;
                    }
                    i++;
                }
            }
            tokens.push('$'); // End of input marker
            return tokens;
        }

        function parse(tokens) {
            const stack = ['$', 'E'];
            let index = 0;
            let stepNumber = 0;
            const derivationSteps = [{ step: stepNumber, production: 'Start', currentString: 'E' }];

            while (stack.length > 1 || index < tokens.length - 1) {
                const top = stack.pop();
                const token = tokens[index];
                console.log(`Step ${stepNumber++}: Top of stack: ${top}, Current token: ${token}`);

                if (parsingTable[top] && parsingTable[top][token]) {
                    const production = parsingTable[top][token];
                    stack.push(...production.reverse().filter(x => x !== 'ε'));
                    derivationSteps.push({ step: stepNumber, production: `${top} → ${production.join(' ')}`, currentString: stack.join(' ') });
                    console.log(`Applying production: ${top} → ${production.join(' ')}`);
                } else if (top === token) {
                    index++;
                } else {
                    console.log(`Syntax error: expected ${top}, found ${token}`);
                    return { result: `Syntax error: expected '${top}' but found '${token}' at position ${index}`, derivationSteps };
                }
            }
            console.log('Parsing completed successfully');
            derivationSteps.push({ step: stepNumber + 1, production: 'End', currentString: stack.join(' ') });
            return { result: "Accepted", derivationSteps };
        }

        function analyzeInput() {
            const inputText = document.getElementById('inputParagraph').value;
            const tokens = lexicalAnalyzer(inputText.trim());
            console.log('Tokens:', tokens);
            if (typeof tokens === 'string') {
                document.getElementById('output').innerText = tokens;
            } else {
                const { result, derivationSteps } = parse(tokens);
                console.log('Parse result:', result);
                console.log('Derivation steps:', derivationSteps);
                document.getElementById('output').innerText = result;
                if (Array.isArray(derivationSteps)) {
                    displayDerivationTable(derivationSteps);
                }
            }
        }

        function displayDerivationTable(derivationSteps) {
            const tableBody = document.getElementById('derivationTableBody');
            tableBody.innerHTML = '';

            derivationSteps.forEach((step) => {
                const row = document.createElement('tr');
                const stepNumberCell = document.createElement('td');
                stepNumberCell.innerText = step.step; // Show the step number
                const stepCell = document.createElement('td');
                stepCell.innerText = step.production; // Show the production
                const currentStringCell = document.createElement('td');
                currentStringCell.innerText = step.currentString;

                row.appendChild(stepNumberCell); // First column: Step number
                row.appendChild(stepCell); // Second column: Derivation
                row.appendChild(currentStringCell); // Third column: Current String
                tableBody.appendChild(row);
            });
        }
    </script>
    <main>
        <textarea id="inputParagraph" placeholder="Type your input here!"></textarea>
        <button onclick="analyzeInput()">Analyze</button>
        <div id="output"></div>
        <table>
            <thead>
                <tr>
                    <th>Step</th>
                    <th>Derivation</th>
                    <th>Current String</th>
                </tr>
            </thead>
            <tbody id="derivationTableBody">
            </tbody>
        </table>
    </main>
</body>
</html>